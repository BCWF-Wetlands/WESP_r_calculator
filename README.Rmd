---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# wespr

<!-- badges: start -->
[![R-CMD-check](https://github.com/BCWF-Wetlands/wespr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BCWF-Wetlands/wespr/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The B.C. Wildlife Federationâ€™s Wetlands Workforce project is a collaboration with conservation organizations and First Nations working to maintain and monitor wetlands across British Columbia. https://bcwf.bc.ca/initiatives/wetlands-workforce/.  

The [Wetland Ecosystem Services Protocol](https://wetlandsworkforce.ca/portfolio/wetlands-ecosystem-services-protocol/) (WESP) model is a standardized method for assessing the function and value of the services provided by wetlands.

wespr is an R package to help automate the validation of WESP data and to calculate 
WESP indicators in a reproducible manner.

## Installation

You can install the development version of wespr from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("BCWF-Wetlands/wespr")
```

## Example usage

```{r example}
library(wespr)
```

Once the package is loaded, we can read in the WESP data from a csv, which should be in a
standardized format as output from the scripts at https://github.com/BCWF-Wetlands/WESP_Calculator.

An example format of the file is shown, with the first 10 questions (rows) and 6 sites (columns) shown:

```
Question,1,2,3,4,5,6
F1_1,1,0,1,1,1,2
F1_2,0,3,3,2,0,2
F1_3,1,0,3,1,1,1
F1_4,1,4,1,1,1,3
F1_5,1,0,1,1,1,0
F1_6,1,1,1,1,1,4
F2_A1,0,0,0,0,0,1
F2_A2,0,0,0,0,0,0
F2_B1,0,1,0,0,0,0
F2_B2,1,0,1,1,1,0
```

We have included an example file in the package, which we can use for demonstration purposes:

```{r}
wesp_file <- system.file("input_data/wetFlat.csv", package = "wespr")
wesp_data <- load_wesp_data(wesp_file)

head(wesp_data)
```

Next we convert the data into a special `wesp_site` object. This process validates
the input data, and will give informative errors if a question is not answered correctly.
It also calculates many "derived values" from the questions, which are common inputs into different
indicator calculations.

If there is more than one site in the input data, you can select which site you
would like to use --- if no site is selected it will default to choosing the first 
site in the file.

```{r}
site <- as.wesp_site(wesp_data, site = 1)
```

You should not normally need to work with the internals of the `wesp_site` object
as it is quite complex, however we can examine the basic structure:

It has four elements:

```{r}
length(site)
names(site)
```

The first three (`site_name`, `questions`, and `derived_values`) are populated when 
the `wesp_site` object is created, but the `indicators` element is just a placeholder:

```{r}
site$site_name

# The questions element is large and complex, so we will just show the names:
names(site$questions)

site$derived_values
```

Now, we can calculate the indicator scores with the `calc_indicators()` function.

You must assign the output of this function back to the original `wesp_site` 
object, as it updates the `indicators` with the calculated values:

```{r}
site <- calc_indicators(site)

site$indicators
```


